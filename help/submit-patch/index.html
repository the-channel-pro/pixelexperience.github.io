<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0'>
    <meta name="description" content="How to submit a patch - PixelExperience Wiki">
    <meta property="og:title" content="How to submit a patch - PixelExperience Wiki">
    <meta property="og:description" content="How to submit a patch - PixelExperience Wiki">
    <meta property="og:site_name" content="How to submit a patch - PixelExperience Wiki">
    <meta property="og:image" content="https://download.pixelexperience.org/images/banner.png" />
    <meta name="keywords" content="wiki,wiki pe,pixel experience,pixel,experience,oreo,google,google pixel,android 10,android q,pie,aosp,ten,android,custom rom,rom">
    <meta name="msapplication-TileColor" content="#2D2D2D">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#2D2D2D">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192"  href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">

    <title>How to submit a patch - PixelExperience Wiki</title>

    <link href="/assets/css/material-kit.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Product+Sans:350,400,500,700|Material+Icons" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E=" crossorigin="anonymous"></script>
    <script src="/assets/js/main.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/3.2.2/anchor.min.js" integrity="sha256-WofcoLT8gToeaSmVRe28qpnlFxdBJH1n4K6Bk3YowvU=" crossorigin="anonymous"></script>


  </head>
  <body>

    <nav class="navbar fixed-top navbar-expand-lg bg-white mb-0 rounded-0">
  <div class="container">
    <div class="navbar-translate">
      <a class="navbar-brand font-weight-bold" href="/"><img src="/images/logo.png" alt="PixelExperience"></a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" aria-expanded="false" aria-label="Toggle navigation">
        <span class="sr-only">Toggle navigation</span>
        <span class="navbar-toggler-icon"></span>
        <span class="navbar-toggler-icon"></span>
        <span class="navbar-toggler-icon"></span>
      </button>
      </div>

      <div class="collapse navbar-collapse">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a href="/devices/" class="nav-link">Devices</a>
          </li>
          <li class="nav-item">
            <a href="/help/contributing/" class="nav-link">Contribute</a>
          </li>
          <li class="nav-item">
            <a href="/help/developer-information/" class="nav-link">Maintainers</a>
          </li>
          <li class="nav-item">
            <a href="https://download.pixelexperience.org" class="nav-link">
              <i class="material-icons">open_in_new</i>
              Website
            </a>
          </li>
        </ul>

        <form class="form-inline ml-auto" autocomplete="off">
          <div class="form-group no-border">
            <i class="material-icons">search</i>
            <input id="search-input" type="text" class="form-control" placeholder="Search">
          </div>

          <ul id="results-container"></ul>


          <script src="/assets/js/jekyll-search.js" type="text/javascript"></script>
          <script type="text/javascript">
              SimpleJekyllSearch.init({
                  searchInput: document.getElementById('search-input'),
                  resultsContainer: document.getElementById('results-container'),
                  dataSource: '/search.json',
                  searchResultTemplate: '<li><a href="{url}" title="How to submit a patch">{title}</a></li>',
                  noResultsText: '<li><a href="#">No results found.</a></li>',
                  limit: 10,
                  fuzzy: true,
              })
          </script>
        </form>

      </div>
    </div>
  </nav>


    <div class="main-content">

      <div class="container page">

  <h1>How to submit a patch</h1>

  
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>
<h2 id="initial-setup">Initial setup</h2>

<p>If you haven’t yet successfully downloaded the source and generated a build of PixelExperience, make sure you are familiar with those steps. Information on doing a build is available in the build guide for <a href="/devices">your device</a>.</p>

<p>Setup an account on <a href="https://gerrit.pixelexperience.org">Gerrit</a> and configure your Gerrit username in the Gerrit portal under <strong>Settings -&gt; HTTP Password</strong>.</p>

<p>Now make sure your local git username matches with your Gerrit username:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git config --global review.gerrit.pixelexperience.org.username "gerrit username"
</code></pre></div></div>

<p>If you already have SSH keys set up (e.g. for GitHub), skip the following two steps.</p>

<p>Generate the SSH keys,<sup><a href="#TroubleshootingTag">[1]</a></sup>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen -t rsa -C "your@email.com"
</code></pre></div></div>

<p>Add the keys to the ssh-agent:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>eval `ssh-agent -s`
ssh-add ~/.ssh/id_rsa
ssh-add
</code></pre></div></div>

<p>After that, copy/paste the content of <code class="highlighter-rouge">~/.ssh/id_rsa.pub</code> to your Gerrit SSH Settings under <strong>Settings -&gt; SSH Public Keys</strong>.</p>

<p>The steps above have to be performed only once.</p>

<h2 id="preparing-the-build-environment">Preparing the build environment</h2>

<p>Go to the root of the source code:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd ~/android/pe
</code></pre></div></div>

<p>Setup your build environment:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>source build/envsetup.sh
</code></pre></div></div>

<p>The rest of this guide will rely on this being done. You can check the proper execution of the commands by typing:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>croot
</code></pre></div></div>

<p>Your shell will then navigate to the root of the sources, <code class="highlighter-rouge">~/android/pe</code> or give an error.</p>

<h2 id="submitting-to-gerrit">Submitting to Gerrit</h2>

<h3 id="uploading-your-changes">Uploading your changes</h3>

<p>First, you need to start a topic branch. This branch holds the changes you make to the files on your computer that you will ultimately send to the PixelExperience’ Gerrit instance for review. Create your topic branch:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>repo start &lt;branch name&gt; &lt;project path&gt;
</code></pre></div></div>

<div class="alert alert-info" role="alert"><div class="alert-icon"><i class="material-icons">info_outline</i></div><div class="alert-text"><b>Note:</b> This starts a new branch called <code class="highlighter-rouge">&lt;branch name&gt;</code> in the <code class="highlighter-rouge">&lt;project path&gt;</code> project. Replace <code class="highlighter-rouge">&lt;project path&gt;</code> with the path of your target repository instead.</div></div>

<p>Change to the project (directory) that contains the file(s) you want to edit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd path/to/project
</code></pre></div></div>

<p>Do all the changes you need.</p>

<div class="alert alert-danger" role="alert"><div class="alert-icon"><i class="material-icons">warning</i></div><div class="alert-text"><b>Warning:</b> Make sure you do not commit any changes before you run <code class="highlighter-rouge">repo start</code>, otherwise your changes will happen on a different branch and will not be tracked correctly.</div></div>

<p>After you make your changes, you can commit them just as you normally would:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add &lt;file you edited&gt;
git commit
</code></pre></div></div>
<p>Alternatively you can run <code class="highlighter-rouge">git add .</code> to stage all changes.</p>

<div class="alert alert-success" role="alert"><div class="alert-icon"><i class="material-icons">check</i></div><div class="alert-text"><b>Tip:</b> The first line of your commit message will become the change’s title. Add a blank line after the title and write the summary of changes there, if you would like. Make sure that each line does not exceed 80 chars and the title should not exceed 50 chars.</div></div>

<p>Now you can upload your changes to Gerrit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>repo upload .
</code></pre></div></div>

<div class="alert alert-info" role="alert"><div class="alert-icon"><i class="material-icons">info_outline</i></div><div class="alert-text"><b>Note:</b> In case you are in the root of the source code, you can type: <code class="highlighter-rouge">repo upload &lt;project path&gt;</code>.</div></div>

<p>That’s it! Your change will be reviewed and may be accepted or rejected. See <a href="#ExampleCasesTag">#Example_cases</a> below for an example.</p>

<h3 id="submitting-patch-sets">Submitting patch sets</h3>

<p>It can happen that your submitted patch has issues or errors, which are noted in the code review, so you will want to resolve them. Sometimes it’s just tabs instead of spaces or typos in strings and variable names. To avoid some formal mistakes, make sure you’re familiar with the Android code style. For Eclipse users, just follow the instructions in <code class="highlighter-rouge">development/ide/eclipse/README.importing-to-eclipse.txt</code>.</p>

<p>Before you edit those files, make sure you are on the correct branch:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git branch
</code></pre></div></div>

<p>If you are not or in no branch at all, switch to the correct branch:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git checkout [branchname]
</code></pre></div></div>

<p>Now you can edit the files you want. After that, do the usual <code class="highlighter-rouge">git status</code> and notice that <code class="highlighter-rouge">git diff</code> will only show you the changes you just made.
Make sure you add the files that you’ve modified by using <code class="highlighter-rouge">git add</code>. Once you’re satisfied, prepare the upload, by amending your commit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git commit --amend
</code></pre></div></div>

<p>This will open an editor with your initial commit message. You can change the commit message if you want to, but make sure the line starting with Change-Id remains unchanged as it contains the initial change ID. With this id, Gerrit will detect your upload as a patch set and not as a new patch.</p>

<div class="alert alert-info" role="alert"><div class="alert-icon"><i class="material-icons">info_outline</i></div><div class="alert-text"><b>Note:</b> The default editor is vi. This can be changed by the EDITOR environment variable to any editor you like.</div></div>

<p>You can do <code class="highlighter-rouge">git log</code> and <code class="highlighter-rouge">git status</code> again. Notice how git handles your initial commit and the amended commit as one single patch. As for <code class="highlighter-rouge">git show</code>, it shows you all the changes made on that commit.</p>

<p>Finally, you can submit your patch set to your initial patch by typing:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>repo upload .
</code></pre></div></div>

<h3 id="ExampleCasesTag">Example cases</h3>

<h4 id="edit-inputdevicejava">Edit <code class="highlighter-rouge">InputDevice.java</code></h4>

<p>Let’s say you want to make a change in <code class="highlighter-rouge">InputDevice.java</code> that resides in the <code class="highlighter-rouge">frameworks/base</code> project, and upload that to Gerrit for review. Start a local branch of that repo (directory) and call it <code class="highlighter-rouge">mychanges</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd frameworks/base
repo start mychanges .
</code></pre></div></div>

<p>Make the edits to that file. You can check those changes:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add InputDevice.java -n
</code></pre></div></div>

<p>If the results are acceptable, stage the modified file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add InputDevice.java
</code></pre></div></div>

<p>Then commit it:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git commit -m 'Added feature xyz'
</code></pre></div></div>

<p>Issue the upload:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>repo upload .
</code></pre></div></div>

<p>You should be asked a few questions and your commit should then be uploaded to Gerrit for review.</p>

<h4 id="add-awext-support">Add AWEXT Support</h4>

<p>Start the new branch:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd external/wpa_supplicant
repo start mychanges-wpa_supplicant .
</code></pre></div></div>

<p>Make changes, edit a few files, add new drivers.. etc.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git add .
git commit -m 'Added AWEXT drivers'
repo upload .
</code></pre></div></div>

<h3 id="TroubleshootingTag">Troubleshooting</h3>

<p><sup>[1]</sup> If you get a “Permission denied (publickey)” error and you’re sure that everything is right, try using a DSA key instead of RSA.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh-keygen -t dsa -C "your@email.com"
</code></pre></div></div>

<h2 id="getting-your-submission-reviewedmerged">Getting your submission reviewed/merged</h2>

<p>All submitted patches go through a code review process prior to being merged. In addition to peer reviews, certain project members have the capability to merge your changes into PixelExperience.
To make sure they get informed:</p>

<p>1) Add reviewers:</p>
<ul>
  <li>For general repos, add the <a href="https://download.pixelexperience.org/about#team">Head Developers</a></li>
</ul>

<p>2) Set the <a href="help/using-gerrit/#reviewing-a-patch">proper labels</a> to indicate your patch is ready</p>

<h2 id="common-commands">Common commands</h2>

<p>See <a href="http://gitimmersion.com/">Git Immersion</a> for more information.</p>

<h3 id="repo"><code class="highlighter-rouge">repo</code></h3>

<ul>
  <li>
    <p><code class="highlighter-rouge">repo abandon &lt;branch name&gt;</code> to abandon any changes (commits) that have not been uploaded.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">repo start &lt;branch&gt; &lt;project&gt;</code> to start repo listening for changes through git.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">repo upload &lt;project name&gt;</code> to upload committed changes to the remote review server.</p>
  </li>
</ul>

<h3 id="git"><code class="highlighter-rouge">git</code></h3>

<ul>
  <li>
    <p><code class="highlighter-rouge">git add &lt;file name&gt;</code> to stage a file that has been changed or added.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git commit -m "comment"</code> to commit a change.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git reset HEAD &lt;file name&gt;</code> to unstage a file.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git revert HEAD</code> to undo the last commit.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">git status</code> to see the status of a project.</p>
  </li>
</ul>

<h3 id="git-subcommands"><code class="highlighter-rouge">git subcommands</code></h3>

<ul>
  <li>
    <p><code class="highlighter-rouge">--date="DATE"</code> to specify the date of change if necessary. DATE has to be in RFC 2822, ISO 8601 or git internal time format.</p>

    <p>Examples:</p>

    <ul>
      <li>
        <p>RFC 2822: Wed, 17 Jan 2018 17:39:48 +0100</p>
      </li>
      <li>
        <p>ISO 8601: 2018-01-17T17:39:48+0100</p>
      </li>
      <li>
        <p>git internal format: 1516210788 +0100</p>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="highlighter-rouge">--author="NAME &lt;EMAIL&gt;"</code> to name the author if you did not write the patch yourself.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">--amend</code> to modify the last commit.</p>
  </li>
</ul>

<h2 id="resources">Resources</h2>

<p><a href="http://gitimmersion.com/">Git Immersion</a></p>

<p><a href="https://source.android.com/source/developing">Git and repo overview</a></p>

<p><a href="https://gerrit.pixelexperience.org/Documentation/index.html">Gerrit Documentation</a></p>


</div>


    </div>

    <footer class="footer mt-5 px-2 py-4 ">
  <div class="container">
    <div class="row">
      <div class="col-md text-center text-md-left">
        <p class="text-muted my-0"><b>&copy; 2018 - 2020 The PixelExperience Project</b></p>
      </div>
      <div class="col-md">
        <p class="text-center text-md-right text-muted">Licensed under <a href="https://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0</a>.<br />
         Site last generated: Aug 18, 2020</p>
      </div>
    </div>
  </div>
</footer>


    <script>anchors.add().remove('h1');</script>

  </body>
</html>
